git-subdir(1)
=============
:author: Robert Bragg
:email: robert@sixbynine.org

NAME
----
git-subdir - Integrate the content of a repository into a subdirectory

SYNOPSIS
--------
[verse]
'git subdir init' [-b <branch>] [--upstream-branch <branch>] <repository> [<upstream-repository] <subdir>
'git subdir fetch' [<subdir>...]
'git subdir commit'[-m <message] [--dry-run] <commit> [<subdir>]
'git subdir clone' [-b <branch>] [--upstream-branch <branch>] <repository> [<upstream-repository>] <subdir>
'git subdir branch' [-b branch] [<subdir>]
'git subdir rebase' [<subdir>]
'git subdir push' [--upstream] [--dry-run] [<subdir>]
'git subdir status' [<subdir>...]
'git subdir config' --key <key> [--value <value>] [--unset] [<subdir>]

DESCRIPTION
------------

'git subdir' maintains the content of an external Git repository within a subdirectory of your repository.

Local changes to the subdirectory can be filtered onto a branch and pushed back upstream. Long lived integration changes (such as to integrate an external project into your build system) are maintained on a branch and rebased each time you sync with the latest upstream.

Developers cloning your project don't need know about or use 'git subdir' as the integration is done via commits to the subdirectory that squash in the result of rebasing your integration changes on the latest upstream.

COMMANDS
--------

init
~~~~

[verse]
'git subdir init' [-b <branch>] [--upstream-branch <branch>]
		<repository> [<upstream-repository] <subdir>
'git subdir init' [-b <branch>] [--upstream-branch <branch>]
		--pre-integrated-commit CORRESPONDING_COMMIT
		<repository> [<upstream-repository] <subdir>
'git subdir init_from_subrepo' [--as-upstream] <subdir>

Creates a <subdir>/ directory containing a .git-subdir file with a record of what repository to integrate and track for changes as well as (optionally) an upstream repository to monitor.

The benefit of specifying a second, upstream repository is that if you need to maintain a set of integration patches for the first <repository>, specific to your project (such as build system integration changes) then git-subdir can help rebase those changes on new upstream changes.

Typically <subdir> wouldn't exist before running 'git subdir init', but it's also possible to create a .git-subdir file for a pre-existing subdirectory (in which case --pre-integrated-commit must be passed to identify a commit from <repository> that the subdirectory contents currently correspond to).

The 'init_from_subrepo' command does much the same same as 'init' but reads the <repository> and <branch> from <subrepo>/.git-config

options
^^^^^^^
-q;;
--quiet;;
	Pass --quiet to 'git subdir fetch' to silence other internally used git commands. Progress is not reported to the standard error stream.
-v;;
--verbose;;
	Be verbose.

-b;;
--branch;;
	The branch to fetch and optionally maintain integration changes on. By default this is 'master'

--upstream-branch;;
	If an <upstream-repository> has been specified then it's also possible to specify which upstream branch to monitor. By default this is 'master'

fetch
~~~~~

[verse]
'git subdir fetch' [<subdir>]

Fetches branches and tags from the configured 'upstream' and 'integration' repositories

options
^^^^^^^
-q;;
--quiet;;
	Pass --quiet to 'git subdir fetch' to silence other internally used git commands. Progress is not reported to the standard error stream.
-v;;
--verbose;;
	Be verbose.

commit
~~~~~~

[verse]
'git subdir commit' [-m <msg>] [--dry-run] <commit> [<subdir>]

Replaces the contents of <subdir> with the contents of <commit> in a single squashed commit. <commit> should be in the layout of the external repository.

If the <commit> is not an upstream commit it should then be pushed to the remote integration branch for others to be able to rebase your project-specific changes onto different upstream versions. Running 'git subdir status' will try to warn when the last squashed <commit> doesn't appear to have been published for others.

Note: it's ok to rebase these squash commits on a topic branch without confusing git-subdir, but it's recommended to avoid squashing extra changes to <subdir> into these commits, otherwise when using 'git subdir branch' you will see a poorly named patch to represent them.

clone
~~~~~

[verse]
'git subdir clone' [-b <branch>] [--upstream-branch <branch>] [-m <msg>] 
		<repository> [<upstream-repository] <subdir>

This is a convenience to 'init', 'fetch' and 'commit' an external repository to <subdir>

The initial <subdir> content will come from the integration <repository> branch if it already exists otherwise it will come from the <upstream-repository>.

branch
~~~~~~

[verse]
'git subdir branch' -b <branch> [<subdir>]

Creates a branch in the layout of the external project, and filters any patches that affect <subdir> onto this branch too. The branch is based on an upstream commit so it's possible to manually push changes upstream from here. Another use case might be to manually rebase on a more recent upstream before committing the result with 'git subdir commit'.

rebase
~~~~~~

[verse]
'git subdir rebase' [<subdir>]

This fetches from the configured upstream and integration repositories, then (if both branches have been configured) rebases integration changes on the latest upstream changes, rebases any local changes on top of this and then commits the result.

This is the recommended way to routinely pull in new upstream changes to <subdir>.

This is a convenience for the following steps:

1. Running 'git subdir fetch'
2. Running 'git subdir branch' to filter local <subdir> changes onto a branch based on your last subdirectory squash commit
3. Running 'git rebase' to rebasing that branch on the latest upstream or integration branch
4. Running 'git subdir commit' to squash the result back into your current branch

status
~~~~~~

[verse]
'git subdir status' [<subdir>...]

Prints out the configuration for each <subdir>, including warnings about commits that have been integrated with 'git subdir commit' but have not yet been published for others.

config
~~~~~~

[verse]
'git subdir config' --key <key> [--value <value>] [<subdir>]
'git subdir config' --key <key> [--unset] [<subdir>]

[verse]
examples:
  'git subdir config' --key upstream.url <subdir>
  'git subdir config' --key upstream.url --value https://foo.git <subdir>
  'git subdir config' --key upstream.branch --value foo <subdir>
  'git subdir config' --key upstream.branch --unset <subdir>
  'git subdir config' --key integration.url <subdir>

Note: this deviates from the standard 'git config' <option> [<value>] UI due to the ambiguity of <value> and <subdir> both being optional


EXAMPLE
-------

Lets say you have a container project 'super' at https://github.com/user/super and another project 'duper' at https://github.com/upstream/duper which you want to embed in the former.

The first thing to decide is where to maintain an 'integration' branch for any changes you might need to track for the 'duper' subdirectory.

Lets assume you don't have privileges to touch the 'upstream/duper' repo so you start by forking it and create https://github.com/user/duper. We'll leave the master branch of this repo alone and create a 'super-integration' branch that we can push to https://github.com/user/duper.

  $ cd super/
  $ git subdir clone -b super-integration http://github.com/user/duper http://github.com/upstream/duper

Now make a local changes to the duper/ subdirectory...

  $ echo "foo" > duper/file.txt
  $ git commit -m 'change file' duper/file.txt

At this point the upstream may have improvements we want, while we still want to keep our change.

  $ git subdir rebase duper

Will fetch the latest upstream, rebase the local change and commit the result back.

If you run 'git subdir status duper' now you will see a warning.

As part of this rebase your local change was rebased on upstream and 'git subdir status' is reminding you to push the rebased branch as your latest super-integration branch.

Also every time a subdirectory is updated (either via a commit or a rebase) then 'git subdir' also creates a 'ref' for the commit whose content is used to update a subdirectory so that the commit can always be used as a base for later 'git subdir' commands. In addition to the integration branch, these refs should also be published for other project maintainers that may want to use 'git subdir' too.

'git subdir push' will push your integration branch (super-integration) and commit refs to your configured integration repo:

  $ git subdir push duper


CONFIGURATION
-------------

git-subdir maintains the configuration for a subdirectory in a .git-subdir file which is tracked as part of your repository history. These files are compatible with 'git config -f .git-subdir' and it's safe to modify (and commit) changes to .git-subdir files with the exception that the 'commit-uuid' line should not be touched since that will interfere with git-subdir identifying the changes that update the subdir contents.

git-subdir will create 'subdir-upstream/<subdir>' and 'subdir-integration/<subdir>' remotes in $GIT_DIR/ but git-subdir never assumes these exist and they are always updated before use based on the current .git-subdir configuration.

COMPARED TO SIMILAR TOOLS
-------------------------

git-subdir serves a similar purpose to git-submodule(1), git-subtree(1) and git-subrepo(1) so here are a few notes to help distinguish the tools.

git-submodule;;
- Developers cloning a repo that uses git-subdir don't need to know about or use git-subdir.
- git-subdir incorporates external content via squash commits that themselves don't retain any history of the external project whereas git-submodule works as an assistant for cloning external git repositories within subdirectories of your project.

git-subtree;;
- git-subtree isn't designed to facilitate rebasing integration changes for an external repository and is generally geared around using merge commits to sync with upstream. For long lived integration changes, this may mean dealing with with conflicts without the original context of the changes when merging.
- Similarly git-subtree doesn't have provisions for rebasing local, upstreamable changes.

git-subrepo;;
- The initial inspiration for git-subdir.
- git-subdir takes a different approach to branching by rebasing and filtering local changes onto an upstream commit to ease upstreaming those local changes.
- By differentiating an integration branch from an upstream branch git-subdir can further streamline the process of upstreaming some changes while maintaining other integration changes private to your project.
- The use of an integration branch avoids loosing track of local subdirectory changes behind the squash commits used to pull in upstream changes.


LICENSE
-------

The MIT License
